@{
    @model TheProjector.Data.ViewModels.ProjectFormViewModel;
ViewData["Title"] = "Edit Project";

}

<div>

    <h3>Edit Project</h3>
    <div asp-validation-summary="ModelOnly" class="text-danger">

    </div>
    <form method="POST">
        <input type="hidden" asp-for="Form.Id" />
        <input asp-for="Form.RowVersion" type="hidden" />
        <div class=" mb-3">
            <label asp-for="Form.Code"></label>
            <input asp-for="Form.Code" class="form-control" placeholder=" " />
            <label class="form-check-label" for="manually-change-code">Customize Code?</label>
            <input type="checkbox" id="manually-change-code" class="form-check-input">
            <p class="p-0 m-0">
                <span asp-validation-for="Form.Code" class="text text-danger"></span>
            </p>
        </div>

        <div class="mb-3">
            <label asp-for="Form.Name"></label>
            <input asp-for="Form.Name" class="form-control" placeholder=" " />
            <span asp-validation-for="Form.Name" class="text text-danger"></span>
        </div>

        <div class=" mb-3">
            <label asp-for="Form.Budget"></label>
            <div class="input-group">
                <div class="input-group-prepend">
                    <span class="input-group-text">
                        <select asp-for="Form.BudgetCurrencyCode" class="form-select">
                            @foreach (var currency in Model.Currencies)
                            {
                                <option value="@currency.Code"
                                    selected="@(currency.Code == (Model.Form.BudgetCurrencyCode))">
                                    @currency.EnglishName
                                    (@currency.Code)
                                </option>
                            }
                        </select>
                    </span>
                </div>
                <input asp-for="Form.Budget" class="form-control" placeholder=" " />
            </div>
            <p>
                <span asp-validation-for="Form.BudgetCurrencyCode" class="text text-danger"></span>
            </p>
            <p>
                <span asp-validation-for="Form.Budget" class="text text-danger"></span>
            </p>
        </div>

        <div class="mb-3">
            <label asp-for="Form.Remarks" class="form-label"></label>
            <textarea class="form-control" asp-for="Form.Remarks" rows="5" placeholder=" "></textarea>
            <span asp-validation-for="Form.Remarks" class="text text-danger"></span>
        </div>

        <input type="submit" class="btn btn-primary" value="Edit">


    </form>



</div>

@section Scripts {
    <script>
        let codeInputElement = document.querySelector("input[name='Form.Code']");
        let nameInputElement = document.querySelector("input[name='Form.Name']");
        let customizeCodeCheckElement = document.querySelector("input#manually-change-code");
        let shouldChangeCodeAutomatically = !customizeCodeCheckElement.checked;
        let nameInputChanged = (event) => {
            if (shouldChangeCodeAutomatically) {
                let autoGeneratedCode = event.target.value.replaceAll(" ", "-").toLowerCase();
                codeInputElement.value = autoGeneratedCode;

            }
        }
        let customizeCodeCheckChanged = (event) => {
            let shouldManuallyChange = event.target.checked;
            codeInputElement.readOnly = !shouldManuallyChange;
            shouldChangeCodeAutomatically = !shouldManuallyChange;
            codeInputElement.readOnly = !shouldManuallyChange;
        }

        (() => {
            let isCodeCustomizedOnLoad = nameInputElement.value.toLowerCase().replaceAll(" ", "-") !== codeInputElement.value;
            shouldChangeCodeAutomatically = !isCodeCustomizedOnLoad;
            customizeCodeCheckElement.checked = isCodeCustomizedOnLoad;
            codeInputElement.readOnly = !isCodeCustomizedOnLoad
        })()
        nameInputElement.addEventListener("keyup", nameInputChanged);
        customizeCodeCheckElement.addEventListener("change", customizeCodeCheckChanged);

    </script>
}